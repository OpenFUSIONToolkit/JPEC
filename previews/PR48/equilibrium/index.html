<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Equilibrium · JPEC.jl</title><meta name="title" content="Equilibrium · JPEC.jl"/><meta property="og:title" content="Equilibrium · JPEC.jl"/><meta property="twitter:title" content="Equilibrium · JPEC.jl"/><meta name="description" content="Documentation for JPEC.jl."/><meta property="og:description" content="Documentation for JPEC.jl."/><meta property="twitter:description" content="Documentation for JPEC.jl."/><meta property="og:url" content="https://OpenFUSIONToolkit.github.io/JPEC/equilibrium/"/><meta property="twitter:url" content="https://OpenFUSIONToolkit.github.io/JPEC/equilibrium/"/><link rel="canonical" href="https://OpenFUSIONToolkit.github.io/JPEC/equilibrium/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">JPEC.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../splines/">Splines</a></li><li><a class="tocitem" href="../vacuum/">Vacuum</a></li><li class="is-active"><a class="tocitem" href>Equilibrium</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#API-Reference"><span>API Reference</span></a></li><li><a class="tocitem" href="#Important-types"><span>Important types</span></a></li><li><a class="tocitem" href="#Key-functions"><span>Key functions</span></a></li><li><a class="tocitem" href="#Example-usage"><span>Example usage</span></a></li><li><a class="tocitem" href="#Notes-and-Caveats"><span>Notes and Caveats</span></a></li><li><a class="tocitem" href="#See-also"><span>See also</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/splines/">Spline Examples</a></li><li><a class="tocitem" href="../examples/vacuum/">Vacuum Examples</a></li><li><a class="tocitem" href="../examples/equilibrium/">Equilibrium Examples</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API Reference</a></li><li class="is-active"><a href>Equilibrium</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Equilibrium</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/OpenFUSIONToolkit/JPEC" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/develop/docs/src/equilibrium.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Equilibrium-Module"><a class="docs-heading-anchor" href="#Equilibrium-Module">Equilibrium Module</a><a id="Equilibrium-Module-1"></a><a class="docs-heading-anchor-permalink" href="#Equilibrium-Module" title="Permalink"></a></h1><p>The Equilibrium module provides tools to read, construct, and analyze magnetohydrodynamic (MHD) plasma equilibria. It wraps a variety of equilibrium file formats (EFIT, CHEASE, SOL, LAR, and others), runs the appropriate direct or inverse solver, and returns a processed <code>PlasmaEquilibrium</code> object ready for downstream calculations.</p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>Key responsibilities of the module:</p><ul><li>Read equilibrium input files and TOML configuration (see <code>EquilibriumConfig</code>).</li><li>Provide convenient constructors for analytic / model equilibria (Large</li></ul><pre><code class="nohighlight hljs">Aspect Ratio, Solev&#39;ev).</code></pre><ul><li>Build spline representations used throughout the code (1D cubic and</li></ul><pre><code class="nohighlight hljs">2D bicubic splines).</code></pre><ul><li>Run the direct or inverse equilibrium solver and post-process results</li></ul><pre><code class="nohighlight hljs">(global parameters, q-profile finding, separatrix finding, GSE checks).</code></pre><p>The module exposes a small public API that covers setup, configuration, and common analyses used by other JPEC components (e.g. <code>DCON</code>, vacuum interfaces).</p><h2 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.DirectBField" href="#JPEC.Equilibrium.DirectBField"><code>JPEC.Equilibrium.DirectBField</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DirectBField</code></pre><p>Internal mutable struct to hold B-field components and their derivatives at a point. It is used as a temporary workspace to avoid allocations in tight loops.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/DirectEquilibrium.jl#L9-L14">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.DirectRunInput" href="#JPEC.Equilibrium.DirectRunInput"><code>JPEC.Equilibrium.DirectRunInput</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DirectRunInput(...)</code></pre><p>A container struct that bundles all necessary inputs for the <code>direct_run</code> function. It is created by the <code>_read_efit</code> function after parsing the raw equilibrium file and preparing the initial splines.</p><p><strong>Fields:</strong></p><ul><li><code>equil_input</code>: The original <code>EquilInput</code> object.</li><li><code>sq_in</code>       # x value: psin       # Quantity 1: F = R*Bt  [m T]       # Quantity 2: mu0 * Pressure (non-negative) [nt^2 / m^2 * mu0 = T^2]       # Quantity 3: q-profile       # Quantity 4: sqrt(psi_norm)</li><li><code>psi_in</code>:       # x, y value: R, Z [m]       # z value : poloidal flux adjusted to be zero at the boundary [Weber/radian]           # 1. ψ(R,Z) = ψ_boundary - ψ(R,Z)           # 2. if ψ = ψ * sign(ψ(centerR,centerZ))</li><li><code>rmin</code>: Minimum R-coordinate of the computational grid [m].</li><li><code>rmax</code>: Maximum R-coordinate of the computational grid [m].</li><li><code>zmin</code>: Minimum Z-coordinate of the computational grid [m].</li><li><code>zmax</code>: Maximum Z-coordinate of the computational grid [m].</li><li><code>psio</code>: The total flux difference <code>abs(ψ_axis - ψ_boundary)</code> [Weber / radian].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L239-L264">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.EquilibriumConfig" href="#JPEC.Equilibrium.EquilibriumConfig"><code>JPEC.Equilibrium.EquilibriumConfig</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">EquilibriumConfig(...)</code></pre><p>A container struct that bundles all necessary configuration settings originally specified in the equil     fortran namelsits.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L95-L100">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.EquilibriumConfig-Tuple{Dict, Dict}" href="#JPEC.Equilibrium.EquilibriumConfig-Tuple{Dict, Dict}"><code>JPEC.Equilibrium.EquilibriumConfig</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Constructor that allows users to form a EquilibriumConfig struct from dictionaries     for convinience when most of the defaults are fine.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L107-L110">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.FieldLineDerivParams" href="#JPEC.Equilibrium.FieldLineDerivParams"><code>JPEC.Equilibrium.FieldLineDerivParams</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">FieldLineDerivParams</code></pre><p>A struct to hold constant parameters for the ODE integration, making them easily accessible within the derivative function <code>direct_fl_der!</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/DirectEquilibrium.jl#L36-L41">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.InverseRunInput" href="#JPEC.Equilibrium.InverseRunInput"><code>JPEC.Equilibrium.InverseRunInput</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">InverseRunInput(...)</code></pre><p>A container struct for inputs to the <code>inverse_run</code> function.</p><p><strong>Fields:</strong></p><ul><li><code>equil_input</code>: The original <code>EquilInput</code> object.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L276-L283">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.LargeAspectRatioConfig" href="#JPEC.Equilibrium.LargeAspectRatioConfig"><code>JPEC.Equilibrium.LargeAspectRatioConfig</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">LargeAspectRatioConfig(...)</code></pre><p>A mutable struct holding parameters for the Large Aspect Ratio (LAR) plasma equilibrium model.</p><p><strong>Fields:</strong></p><ul><li><code>lar_r0</code>: The major radius of the plasma [m].</li><li><code>lar_a</code>: The minor radius of the plasma [m].</li><li><code>beta0</code>: The beta value on axis (normalized pressure).</li><li><code>q0</code>: The safety factor on axis.</li><li><code>p_pres</code>: The exponent for the pressure profile, defined as <code>p00 * (1 - (r / a)^2)^p_pres</code>.</li><li><code>p_sig</code>: The exponent that determines the shape of the current-related function profile.</li><li><code>sigma_type</code>: The type of sigma profile, can be &quot;default&quot; or &quot;wesson&quot;. If &quot;wesson&quot;, the sigma profile is defined as <code>sigma0 * (1 - (r / a)^2)^p_sig</code>.</li><li><code>mtau</code>: The number of grid points in the poloidal direction.</li><li><code>ma</code>: The number of grid points in the radial direction.</li><li><code>zeroth</code>: If set to true, it neglects the Shafranov shift</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L149-L166">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.LargeAspectRatioConfig-Tuple{String}" href="#JPEC.Equilibrium.LargeAspectRatioConfig-Tuple{String}"><code>JPEC.Equilibrium.LargeAspectRatioConfig</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Outer constructor for LargeAspectRatioConfig that enables a toml file     interface for specifying the configuration settings</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L185-L188">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.PlasmaEquilibrium" href="#JPEC.Equilibrium.PlasmaEquilibrium"><code>JPEC.Equilibrium.PlasmaEquilibrium</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">PlasmaEquilibrium(...)</code></pre><p>The final, self-contained result of the equilibrium reconstruction. This object provides a complete representation of the processed plasma equilibrium in flux coordinates.</p><p><strong>Fields:</strong></p><ul><li><code>equil_input</code>: The original <code>EquilInput</code> object used for the reconstruction.</li><li><code>sq</code>: The final 1D profile spline (<code>CubicSpline{Float64}</code>).       # x value: normalized psi       # Quantity 1: Toroidal Field Function * 2π, <code>F * 2π</code> (where <code>F = R * B_toroidal</code>)       # Quantity 2: Pressure * μ₀, <code>P * μ₀</code>.       # Quantity 3: dVdpsi       # Quantity 4: q</li><li><code>rzphi</code>: The final 2D flux-coordinate mapping spline (<code>BicubicSpline</code>).       # x value: normlized psi       # y value: SFL poloidal angle [0,1]       # Quantity 1: r<em>coord² = (R - ro)² + (Z - zo)²       # Quantity 2: Offset between the geometric poloidal angle (η) and the new angle (θ</em>new)                    `η / (2π) - θ_new       # Quantity 3: ν in ϕ=2πζ+ν(ψ,θ)       # Quantity 4: Jacobian.</li><li><code>eqfun</code>: A 2D spline storing local physics and geometric quantities that vary across the flux surfaces.       # These are pre-calculated for efficient use in subsequent stability and transport codes.       # x value: Normalized poloidal flux, ψ<em>norm ∈ [0, 1].       # y value: SFL poloidal angle, θ</em>new ∈ [0, 1].       # Quantity 1: Total magnetic field strength, B [T]       # Quantity 2: (e₁⋅e₂ + q⋅e₃⋅e₁) / (J⋅B²).       # Quantity 3: (e₂⋅e₃ + q⋅e₃⋅e₃) / (J⋅B²).</li><li><code>ro</code>: R-coordinate of the magnetic axis [m].</li><li><code>zo</code>: Z-coordinate of the magnetic axis [m].</li><li><code>psio</code>: Total flux difference <code>|Ψ_axis - Ψ_boundary|</code> [Weber / radian].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L352-L384">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.SolevevConfig" href="#JPEC.Equilibrium.SolevevConfig"><code>JPEC.Equilibrium.SolevevConfig</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SolevevConfig(...)</code></pre><p>A mutable struct holding parameters for the Solev&#39;ev (SOL) plasma equilibrium model.</p><p><strong>Fields:</strong></p><ul><li><code>mr</code>: number of radial grid zones</li><li><code>mz</code>: number of axial grid zones</li><li><code>ma</code>: number of flux grid zones</li><li><code>e</code>:  elongation</li><li><code>a</code>: minor radius</li><li><code>r0</code>: major radius</li><li><code>q0</code>: safety factor at the o-point</li><li><code>p0fac</code>: scale on-axis pressure (P-&gt; P+P0*p0fac. beta changes. Phi,q constant)</li><li><code>b0fac</code>: scale toroidal field at constant beta (s<em>Phi,s</em>f,s^2*P. bt changes. Shape,beta constant)</li><li><code>f0fac</code>: scale toroidal field at constant pressure (s*f. beta,q changes. Phi,p,bp constant)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L197-L214">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.SolevevConfig-Tuple{String}" href="#JPEC.Equilibrium.SolevevConfig-Tuple{String}"><code>JPEC.Equilibrium.SolevevConfig</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Outer constructor for LarConfig that enables a toml file     interface for specifying the configuration settings</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/EquilibriumTypes.jl#L228-L231">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium._read_1d_gfile_format-Tuple{Vector{String}, Int64}" href="#JPEC.Equilibrium._read_1d_gfile_format-Tuple{Vector{String}, Int64}"><code>JPEC.Equilibrium._read_1d_gfile_format</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p><em>read</em>1d<em>gfile</em>format(lines<em>block, num</em>values)</p><p>Internal helper function to parse Fortran-style fixed-width numerical blocks from a vector of strings.</p><p><strong>Arguments:</strong></p><ul><li><code>lines_block</code>: A <code>Vector{String}</code> containing the lines to parse.</li><li><code>num_values</code>: The total number of <code>Float64</code> values to read from the block.</li></ul><p><strong>Returns:</strong></p><ul><li>A <code>Vector{Float64}</code> containing the parsed values.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/ReadEquilibrium.jl#L8-L19">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.direct_fl_der!-Tuple{Any, Any, JPEC.Equilibrium.FieldLineDerivParams, Any}" href="#JPEC.Equilibrium.direct_fl_der!-Tuple{Any, Any, JPEC.Equilibrium.FieldLineDerivParams, Any}"><code>JPEC.Equilibrium.direct_fl_der!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">direct_fl_der!(dy, y, params, eta)</code></pre><p>The derivative function for the field-line integration ODE. This is passed to the <code>DifferentialEquations.jl</code> solver.</p><p><strong>Arguments:</strong></p><ul><li><code>dy</code>: The derivative vector (output, modified in-place).</li><li><code>y</code>: The state vector <code>[∫(dl/Bp), rfac, ∫(dl/(R²Bp)), ∫(jac*dl/Bp)]</code>.</li><li><code>params</code>: A <code>FieldLineDerivParams</code> struct with all necessary parameters.</li><li><code>eta</code>: The independent variable (geometric angle <code>η</code>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/DirectEquilibrium.jl#L328-L339">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.direct_fl_int-Tuple{Int64, Float64, JPEC.Equilibrium.DirectRunInput, Float64, Float64, Float64}" href="#JPEC.Equilibrium.direct_fl_int-Tuple{Int64, Float64, JPEC.Equilibrium.DirectRunInput, Float64, Float64, Float64}"><code>JPEC.Equilibrium.direct_fl_int</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">direct_fl_int(ipsi, psifac, raw_profile, ro, zo, rs2)</code></pre><p>Performs the field-line integration for a single flux surface.</p><p><strong>Arguments:</strong></p><ul><li><code>ipsi</code>: The index of the current flux surface.</li><li><code>psifac</code>: The normalized psi value for the surface (ψ_norm).</li><li><code>raw_profile</code>: The <code>DirectRunInput</code> object containing splines and parameters.</li><li><code>ro</code>, <code>zo</code>: Coordinates of the magnetic axis [m].</li><li><code>rs2</code>: R-coordinate of the outboard separatrix [m].</li></ul><p><strong>Returns:</strong></p><ul><li><code>y_out</code>: A matrix containing the integrated quantities vs. the geometric angle <code>η</code>.</li><li><code>bf_start</code>: A <code>DirectBField</code> object with values at the integration start point.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/DirectEquilibrium.jl#L250-L265">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.direct_get_bfield!-Tuple{JPEC.Equilibrium.DirectBField, Float64, Float64, JPEC.SplinesMod.BicubicSpline, JPEC.SplinesMod.CubicSpline, Float64}" href="#JPEC.Equilibrium.direct_get_bfield!-Tuple{JPEC.Equilibrium.DirectBField, Float64, Float64, JPEC.SplinesMod.BicubicSpline, JPEC.SplinesMod.CubicSpline, Float64}"><code>JPEC.Equilibrium.direct_get_bfield!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">direct_get_bfield!(bf_out, r, z, psi_in, sq_in, psio; derivs=0)</code></pre><p>Calculates the magnetic field and its derivatives at a given (R,Z) point. The results are stored in-place in the <code>bf_out</code> object.</p><p><strong>Arguments:</strong></p><ul><li><code>bf_out</code>: A mutable <code>DirectBField</code> struct to store the results.</li><li><code>r</code>: The R-coordinate [m].</li><li><code>z</code>: The Z-coordinate [m].</li><li><code>psi_in</code>: The 2D bicubic spline for poloidal flux <code>ψ(R,Z)</code>.</li><li><code>sq_in</code>: The 1D cubic spline for profiles <code>F(ψ_norm)</code> and <code>P(ψ_norm)</code>.</li><li><code>psio</code>: The total flux difference <code>|ψ_axis - ψ_boundary|</code>.</li></ul><p><strong>Keyword Arguments:</strong></p><ul><li><code>derivs</code>: An integer specifying the derivative level to compute.<ul><li><code>0</code>: Calculates <code>ψ</code>, <code>F</code>, and <code>P</code>.</li><li><code>1</code>: Also calculates 1st derivatives of <code>ψ</code> and <code>B</code> field components.</li><li><code>2</code>: Also calculates 2nd derivatives of <code>ψ</code> and 1st derivatives of <code>B</code>.</li></ul></li></ul><p><strong>Returns:</strong></p><ul><li><code>nothing</code>. The <code>bf_out</code> object is modified in-place.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/DirectEquilibrium.jl#L54-L76">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.direct_position-Tuple{JPEC.SplinesMod.BicubicSpline, JPEC.SplinesMod.CubicSpline, Vararg{Float64, 5}}" href="#JPEC.Equilibrium.direct_position-Tuple{JPEC.SplinesMod.BicubicSpline, JPEC.SplinesMod.CubicSpline, Vararg{Float64, 5}}"><code>JPEC.Equilibrium.direct_position</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">direct_position(psi_in, sq_in, psio, ro_guess, zo_guess, rmin, rmax)</code></pre><p>Finds the key geometric locations of the equilibrium: the magnetic axis (O-point) and the inboard/outboard separatrix crossings on the midplane.</p><p><strong>Arguments:</strong></p><ul><li><code>psi_in</code>: The 2D <code>ψ(R,Z)</code> spline.</li><li><code>sq_in</code>: The 1D profile spline.</li><li><code>psio</code>: Initial flux difference.</li><li><code>ro_guess</code>, <code>zo_guess</code>: Initial guess for the magnetic axis location [m].</li><li><code>rmin</code>, <code>rmax</code>: Radial bounds of the computational domain [m].</li></ul><p><strong>Returns:</strong></p><ul><li><code>ro</code>: R-coordinate of the magnetic axis [m].</li><li><code>zo</code>: Z-coordinate of the magnetic axis [m].</li><li><code>rs1</code>: R-coordinate of the inboard separatrix crossing [m].</li><li><code>rs2</code>: R-coordinate of the outboard separatrix crossing [m].</li><li><code>psi_in_new</code> : returns psi_in renormalized by * psio/psi(ro,zo)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/DirectEquilibrium.jl#L134-L153">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.direct_refine-Tuple{Float64, Float64, Float64, JPEC.Equilibrium.FieldLineDerivParams}" href="#JPEC.Equilibrium.direct_refine-Tuple{Float64, Float64, Float64, JPEC.Equilibrium.FieldLineDerivParams}"><code>JPEC.Equilibrium.direct_refine</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">direct_refine(rfac, eta, psi0, params)</code></pre><p>Refines the radial distance <code>rfac</code> at a given angle <code>eta</code> to ensure the point lies exactly on the target flux surface <code>psi0</code>.</p><p><strong>Arguments:</strong></p><ul><li><code>rfac</code>: The current guess for the radial distance from the magnetic axis.</li><li><code>eta</code>: The geometric poloidal angle.</li><li><code>psi0</code>: The target <code>ψ</code> value for the flux surface.</li><li><code>params</code>: A <code>FieldLineDerivParams</code> struct.</li></ul><p><strong>Returns:</strong></p><ul><li>The refined <code>rfac</code> value.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/DirectEquilibrium.jl#L373-L387">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.equilibrium_separatrix_find!-Tuple{JPEC.Equilibrium.PlasmaEquilibrium}" href="#JPEC.Equilibrium.equilibrium_separatrix_find!-Tuple{JPEC.Equilibrium.PlasmaEquilibrium}"><code>JPEC.Equilibrium.equilibrium_separatrix_find!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">equilibrium_separatrix_find!(pe::PlasmaEquilibrium)</code></pre><p>Finds the separatrix locations in the plasma equilibrium (rsep, zsep, rext, zext).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/Equilibrium.jl#L107-L110">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.equilibrium_solver-Tuple{JPEC.Equilibrium.DirectRunInput}" href="#JPEC.Equilibrium.equilibrium_solver-Tuple{JPEC.Equilibrium.DirectRunInput}"><code>JPEC.Equilibrium.equilibrium_solver</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">equilibrium_solver(raw_profile)</code></pre><p>The main driver for the direct equilibrium reconstruction. It orchestrates the entire process from finding the magnetic axis to integrating along field lines and constructing the final coordinate and physics quantity splines.</p><p><strong>Arguments:</strong></p><ul><li><code>raw_profile</code>: A <code>DirectRunInput</code> object containing the initial splines (<code>psi_in</code>, <code>sq_in</code>) and run parameters (<code>equil_input</code>).</li></ul><p><strong>Returns:</strong></p><ul><li>A <code>PlasmaEquilibrium</code> object containing the final, processed equilibrium data, including the profile spline (<code>sq</code>), the coordinate mapping spline (<code>rzphi</code>), and the physics quantity spline (<code>eqfun</code>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/DirectEquilibrium.jl#L418-L433">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.inverse_extrap-Tuple{Matrix{Float64}, Matrix{Float64}, Float64}" href="#JPEC.Equilibrium.inverse_extrap-Tuple{Matrix{Float64}, Matrix{Float64}, Float64}"><code>JPEC.Equilibrium.inverse_extrap</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">inverse_extrap(xx::Matrix{Float64}, ff::Matrix{Float64}, x::Float64) -&gt; Vector{Float64}</code></pre><p>Performs component-wise Lagrange extrapolation for a vector-valued function.</p><p><strong>Arguments:</strong></p><ul><li><code>xx</code>: A (m × n) matrix where each row contains the x-values for each component.</li><li><code>ff</code>: A (m × n) matrix where each row contains function values at the corresponding <code>xx</code>.</li><li><code>x</code>: A scalar Float64 value at which to extrapolate.</li></ul><p><strong>Returns:</strong></p><ul><li>A vector of length n representing the extrapolated function values at <code>x</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/InverseEquilibrium.jl#L9-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.lar_init_conditions-Tuple{Float64, JPEC.Equilibrium.LargeAspectRatioConfig}" href="#JPEC.Equilibrium.lar_init_conditions-Tuple{Float64, JPEC.Equilibrium.LargeAspectRatioConfig}"><code>JPEC.Equilibrium.lar_init_conditions</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lar_init_conditions(rmin, sigma_type, params)</code></pre><p>Initializes the starting radius and state vector for solving the LAR ODE system. Also evaluates the initial derivative using the analytic model.</p><p><strong>Arguments:</strong></p><ul><li><code>rmin</code>: Normalized starting radius (as a fraction of <code>lar_a</code>).</li><li><code>lar_input</code>: A <code>LargeAspectRatioConfig</code> object containing equilibrium parameters.</li></ul><p><strong>Returns:</strong></p><ul><li><code>r</code>: Physical radius corresponding to <code>rmin * lar_a</code>.</li><li><code>y</code>: Initial state vector of length 5.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/AnalyticEquilibrium.jl#L6-L19">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.read_chease2-Tuple{JPEC.Equilibrium.EquilibriumConfig}" href="#JPEC.Equilibrium.read_chease2-Tuple{JPEC.Equilibrium.EquilibriumConfig}"><code>JPEC.Equilibrium.read_chease2</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_read_chease2(equil_in)</code></pre><p>Parses a chease2 file, creates initial 1D and 2D splines, finds magnetic axis, and bundles them into a <code>InverseRunInput</code> object.</p><p><strong>Arguments:</strong></p><ul><li><code>equil_in</code>: The <code>EquilInput</code> object containing the filename and parameters.</li></ul><p><strong>Returns:</strong></p><ul><li>A <code>InverseRunInput</code> object ready for the inverse solver.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/ReadEquilibrium.jl#L129-L139">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.read_efit-Tuple{JPEC.Equilibrium.EquilibriumConfig}" href="#JPEC.Equilibrium.read_efit-Tuple{JPEC.Equilibrium.EquilibriumConfig}"><code>JPEC.Equilibrium.read_efit</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_read_efit(equil_in)</code></pre><p>Parses an EFIT g-file, creates initial 1D and 2D splines, and bundles them into a <code>DirectRunInput</code> object.</p><p><strong>Arguments:</strong></p><ul><li><code>equil_in</code>: The <code>EquilInput</code> object containing the filename and parameters.</li></ul><p><strong>Returns:</strong></p><ul><li>A <code>DirectRunInput</code> object ready for the direct solver.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/ReadEquilibrium.jl#L47-L57">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.setup_equilibrium" href="#JPEC.Equilibrium.setup_equilibrium"><code>JPEC.Equilibrium.setup_equilibrium</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">setup_equilibrium(equil_input::EquilInput)</code></pre><p>The main public API for the <code>Equilibrium</code> module. It orchestrates the entire process of reading an equilibrium file, running the appropriate solver, and returning the final processed <code>PlasmaEquilibrium</code> object.</p><p><strong>Arguments:</strong></p><ul><li><code>equil_input</code>: An <code>EquilInput</code> object containing all necessary setup parameters.</li></ul><p><strong>Returns:</strong></p><ul><li>A <code>PlasmaEquilibrium</code> object containing the final result.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/Equilibrium.jl#L25-L36">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JPEC.Equilibrium.sol_run-Tuple{JPEC.Equilibrium.EquilibriumConfig, JPEC.Equilibrium.SolevevConfig}" href="#JPEC.Equilibrium.sol_run-Tuple{JPEC.Equilibrium.EquilibriumConfig, JPEC.Equilibrium.SolevevConfig}"><code>JPEC.Equilibrium.sol_run</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>This is a Julia version of the Fortran code in sol.f, implementing Soloviev&#39;s analytical equilibrium.</p><p><strong>Arguments:</strong></p><ul><li><code>mr</code>: Number of radial grid zones</li><li><code>mz</code>: Number of axial grid zones</li><li><code>ma</code>: Number of flux grid zones</li><li><code>e</code>: Elongation</li><li><code>a</code>: Minor radius</li><li><code>r0</code>: Major radius</li><li><code>q0</code>: Safety factor at the o-point</li><li><code>p0fac</code>: Scales on axis pressure (s*P. beta changes. Phi,q constant)</li><li><code>b0fac</code>: Scales on toroidal field (s<em>Phi,s</em>f,s^2*P. bt changes. Shape,beta constant)</li><li><code>f0fac</code>: Scales on toroidal field (s*f. bt,q changes. Phi,p,bp constant)</li></ul><p><strong>Returns:</strong></p><ul><li><code>plasma_eq</code>: PlasmaEquilibrium object</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/OpenFUSIONToolkit/JPEC/blob/95cae2745c953259527db3fc33f696dadeaa18ef/src/Equilibrium/AnalyticEquilibrium.jl#L213-L230">source</a></section></article><h2 id="Important-types"><a class="docs-heading-anchor" href="#Important-types">Important types</a><a id="Important-types-1"></a><a class="docs-heading-anchor-permalink" href="#Important-types" title="Permalink"></a></h2><ul><li><code>EquilibriumConfig</code> — top-level configuration container parsed from a</li></ul><pre><code class="nohighlight hljs">TOML file (outer constructor `EquilibriumConfig(path::String)` is
provided).</code></pre><ul><li><code>EquilibriumControl</code> — low-level control parameters (grid, jacobian</li></ul><pre><code class="nohighlight hljs">type, tolerances, etc.).</code></pre><ul><li><code>EquilibriumOutput</code> — options controlling what output is written.</li><li><code>PlasmaEquilibrium</code> — the runtime structure containing spline fields,</li></ul><pre><code class="nohighlight hljs">geometry, profiles, and computed diagnostics (q-profile, separatrix,
etc.).</code></pre><ul><li><code>LargeAspectRatioConfig</code>, <code>SolevevConfig</code> — convenience structs to</li></ul><pre><code class="nohighlight hljs">construct analytic/model equilibria when using `eq_type = &quot;lar&quot;` or
`eq_type = &quot;sol&quot;`.</code></pre><h2 id="Key-functions"><a class="docs-heading-anchor" href="#Key-functions">Key functions</a><a id="Key-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Key-functions" title="Permalink"></a></h2><ul><li><code>setup_equilibrium(path::String = &quot;equil.toml&quot;)</code></li></ul><pre><code class="nohighlight hljs">— main entry point that reads configuration, builds the equilibrium,
runs the solver, and returns a `PlasmaEquilibrium` instance.</code></pre><ul><li><code>equilibrium_separatrix_find!(pe::PlasmaEquilibrium)</code> — locate</li></ul><pre><code class="nohighlight hljs">separatrix and related boundary geometry in-place.</code></pre><ul><li><code>equilibrium_global_parameters!(pe::PlasmaEquilibrium)</code> — populate</li></ul><pre><code class="nohighlight hljs">common global parameters (major radius, magnetic axis, volumes, etc.).</code></pre><ul><li><code>equilibrium_qfind!(pe::PlasmaEquilibrium)</code> — compute safety factor</li></ul><pre><code class="nohighlight hljs">(q) information across the grid.</code></pre><ul><li><code>equilibrium_gse!(pe::PlasmaEquilibrium)</code> — diagnostics on the</li></ul><pre><code class="nohighlight hljs">Grad–Shafranov solution.</code></pre><h2 id="Example-usage"><a class="docs-heading-anchor" href="#Example-usage">Example usage</a><a id="Example-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Example-usage" title="Permalink"></a></h2><p>Basic example: read a TOML config and build an equilibrium</p><pre><code class="language-julia hljs">using JPEC

# Build from a TOML file (searches relative paths if needed)
pe = JPEC.Equilibrium.setup_equilibrium(&quot;docs/examples/dcon.toml&quot;)

println(&quot;Magnetic axis: &quot;, pe.params.r0, &quot;, &quot;, pe.params.z0)
println(&quot;q(0) = &quot;, pe.params.q0)

# Find separatrix (in-place) and inspect results
JPEC.Equilibrium.equilibrium_separatrix_find!(pe)
println(&quot;rsep = &quot;, pe.params.rsep)</code></pre><p>Analytic / testing example: construct a large-aspect-ratio model</p><pre><code class="language-julia hljs">using JPEC

# Create a LAR config from a small TOML fragment or file
larcfg = JPEC.Equilibrium.LargeAspectRatioConfig(lar_r0=10.0, lar_a=1.0, beta0=1e-3)
pe = JPEC.Equilibrium.setup_equilibrium(JPEC.Equilibrium.EquilibriumConfig(control=Dict(&quot;eq_filename&quot;=&gt;&quot;unused&quot;,&quot;eq_type&quot;=&gt;&quot;lar&quot;)), larcfg)

println(&quot;Built LAR equilibrium with a = &quot;, lorcfg.lar_a)</code></pre><p>Notes:</p><ul><li>The <code>EquilibriumConfig(path::String)</code> constructor parses TOML and</li></ul><pre><code class="nohighlight hljs">expects `[EQUIL_CONTROL]` to contain at minimum `eq_filename` and
`eq_type` fields. Paths that are not absolute are resolved relative
to the TOML file location.</code></pre><ul><li>When <code>eq_type == &quot;inverse_testing&quot;</code> a small example inverse run is</li></ul><pre><code class="nohighlight hljs">constructed (useful in tests and examples).</code></pre><h2 id="Notes-and-Caveats"><a class="docs-heading-anchor" href="#Notes-and-Caveats">Notes and Caveats</a><a id="Notes-and-Caveats-1"></a><a class="docs-heading-anchor-permalink" href="#Notes-and-Caveats" title="Permalink"></a></h2><ul><li>Many routines rely on spline representations; the <code>Splines</code> module is</li></ul><pre><code class="nohighlight hljs">used heavily and should be initialized where appropriate.</code></pre><ul><li>The Equilibrium module contains several reader routines for external</li></ul><pre><code class="nohighlight hljs">formats (EFIT/CHEASE) and also interfaces to older Fortran helpers —
ensure required data files are present for those backends.</code></pre><ul><li>For programmatic usage, prefer constructing <code>EquilibriumConfig</code> from a</li></ul><pre><code class="nohighlight hljs">TOML file to ensure all path resolution and defaults are handled.</code></pre><h2 id="See-also"><a class="docs-heading-anchor" href="#See-also">See also</a><a id="See-also-1"></a><a class="docs-heading-anchor-permalink" href="#See-also" title="Permalink"></a></h2><ul><li><code>docs/src/splines.md</code> — spline helpers used by equilibrium routines</li><li><code>docs/src/vacuum.md</code> — coupling between equilibrium and vacuum solvers</li></ul><p>```</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../vacuum/">« Vacuum</a><a class="docs-footer-nextpage" href="../examples/splines/">Spline Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Saturday 11 October 2025 18:03">Saturday 11 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
